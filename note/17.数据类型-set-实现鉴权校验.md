# set 数据类型的注意事项

- set 不允许数据重复，如果添加的数据在 set 中已经存在，将只保留一份

- set 虽然与 hash 的存储结构相同，但是无法启动 hash 中存储值的空间

## set 类型应用场景

**业务场景**

集团公司共有 12000 名员工，内部 OA 系统具有 700 多个角色，3000 多个业务操作，每位员工有一个或者多个角色，如何快速进行业务操作的权限校验。

**解决方案**

- 依赖 set 集合数据不重复的特征，依赖 set 集合 hash 存储结构特征完成数据过滤与快速查询
- 根据用户 id 获取用户所有的角色
- 根据用户所有角色获取用户所有操作放入 set 集合
- 根据用户所有角色获取用户所有数据放入 set 集合

示例如下：

```
# 给001角色添加2个权限：getall、getById
sadd rid:001 getall
sadd rid:001 getById

# 给002角色添加3个权限：getCount、getall、insert
sadd rid:002 getCount
sadd rid:002 getall
sadd rid:002 insert

# 将两个角色所有权限的交集保存给 007 用户
sunionstore uid:007 rid:001 rid:002

# 这时候查询 007 用户的权限连接
smembers uid:007
```

可以看到用户 007 具有已经包含和 001 角色和 002 角色的所有权限，如下：

```
1) "getCount"
2) "insert"
3) "getall"
4) "getById"
```

当然，除了查询处用户 007 的所有权限，我们还能检验 007 是否具有具体某个权限，如下指令

```
sismember uid:007 insert
```

这是返回结果如下

```
(integer) 1
```

可以看到 uid:007 这个集合包含 insert 这个元素，可以证明 007 这个用户具有 insert 权限

## 检验工作：redis 提供基础的数据还是提供最终的校验结果？

根据上面的权限校验示例，我们可以通过上面两种方式检验用户是否具有某个权限。第一种是先拿数据再到业务逻辑进行校验，第二种是直接把业务校验的工作直接融合到数据查询里来了。第二种可以说是直接取校验结果。我们可以根据实际需求选择第一种还是第二种，但是在大型的模块化应用中，更鼓励大家使用 第一种方法：数据读取与业务逻辑分离。

- Tips 10
- redis 应用于同类型不重复数据的合并操作
