> string 存储类型的困惑

对象数据的存储如果具有较频繁的更新需求操作会显得笨重。

例如：user:id:100 -> {"id":100,"name":"春晚","fans":12355,"blogs":99,"focus:83}

为了解决这个问题，我们引入新的数据类型：hash

- 新的需求：对一系列存储的数据进行编组，方便管理，典型应用存储对象信息
- 需要存储的结构：一个存储空间保存多个键值对数据

如下图：
![01](./img/02.png)

hash 存储结构优化

- 如果 field 数量较小，存储结构优化为类数组结构
- 如果 field 数量较多，存储结构使用 HashMap 结构

## 一、hash 类型数据的基本操作

- 修改/添加数据

```
hset key field value
```

- 修改/添加数据

```
hget key field
hgetall key
```

- 删除操作

```
hdel key field1 [field2]
```

- 修改/添加多个数据

```
hmset key field1 value1 fild2 value2
```

- 返回 hash 表中，一个或多个给定字段的值

```
hmget key field1 field2
```

- 获取 hash 表中字段的数量

```
hget key
```

- 获取 hash 表中是否存在指定的字段

```
hexists key field
```

## 二、hash 类型数据扩展操作

- 获取 hash 表中所有字段名或字段值

```
hkey key
hvals key
```

- 设置指定字符段的数值数据增加指定范围的值

```
hincrby key field increment
hincrbyfloat key field increment
```

hash 类型数据操作注意事项

- hash 类型下的 value 只能存储字符串，不允许存储其他数据类型，不存在嵌套对象。如果数据未获取到，对应的值为(nil)

- 每个 hash 可以存储 2 的 32 次方减 1 个键值对

- hash 类型十分贴近对象的数据存储形式，并且可以灵活添加删除对象属性。但 hash 设计初衷不是为了存储大量对象而设计，切记不可滥用，更不可以将 hash 最为对象列表使用。

- hgetall 操作可以获取全部属性，如果内部 field 过多，遍历整个数据效率会很低，有可能成为数据访问瓶颈。
