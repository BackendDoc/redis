# string 类型的扩展操作

## 一、业务场景 1

大型企业级应用中，分表操作是基本操作，使用多张表存储同类型数据，但是对应的主键 id 必须保证统一性，不能重复。Oracle 数据库具有 sequence 设定，可以解决该问题，但是 MySQL 数据库并不具有此类机制，那怎么解决？

### 1.解决方案

设置数值数据添加制定范围的值

```
# 对key的值增加1个单位
incr key
# 指定对key的值增加increment个单位
incrby key increment
# 指定对key的值增加increment值，increment可以是float类型的值
incrbyfloat key increment
```

设置数值减少指定范围的值

```
# 对key的值减少1个单位
decr key
# 指定对key的值减小increment个单位
decrby key increment
```

### 2.string 作为数值操作

- string 在 redis 中内部存储默认就是一个字符串，当遇到增减类操作 incr，decr 时会转成数值型进行计算。
- redis 所有的操作都是原子性的，采用单线程处理所有的业务，命令是一个一个执行的，因此无需考虑并发带来的数据影响。
- 注意：按数值进行操作的数据，如果原始数据不能转成数值，或超越 redis 数值的上限范围，将会报错。
  最大值为 9223372036854775807（java 中 long 型数据的最大值，Long.MAX_VALUE）

## 二、业务场景 2

“最强女生”启动海选投票，只能通过微信投票，每个微信号每 4 个小时只能投 1 票。

电商商家开启热门商品推荐，热门商品不能一直处于热门期，每种商品热门期维持 3 天，3 天后自动取消热门。

新闻网站会出现热点新闻，热点新闻最大的特征是实效性，如何自动控制热点新闻的时效性。

- 解决方案
  设置数据具有指定的声明周期

```
setx key seconds value
psetx key millisenconds value
```

redis 控制数据的声明周期，通过数据是否失效控制业务行为，适用于有所具有时效性限定控制的操作。

